/* --- Night City (Uses Layout 1 Structure) --- */
.room-background.night_city .room-wall {
    height: 50vh !important;
    /* Deep Night Sky Gradient (Top 33% is Sky) */
    background: linear-gradient(180deg, #141E30 0%, #243B55 33%, #000 33%);
    border-bottom: none;
    overflow: hidden;
    position: relative;
}

.room-background.night_city .room-floor {
    height: 80vh !important;
    margin-top: -30vh !important;
    /* Asphalt Floor */
    background: #2c2c2c;
    border-top-left-radius: 50% 40px;
    border-top-right-radius: 50% 40px;
    overflow: hidden;
    box-shadow: 0 -5px 15px rgba(0, 0, 0, 0.4);
    position: relative;
    /* Asphalt Texture (Grain) */
    background-image:
        radial-gradient(rgba(255, 255, 255, 0.05) 1px, transparent 1px);
    background-size: 4px 4px;
}

/* Moon */
.room-background.night_city .city-moon {
    position: absolute;
    top: 5%;
    right: 15%;
    font-size: 30px;
    filter: drop-shadow(0 0 8px rgba(255, 255, 200, 0.8));
    transform: rotate(-15deg);
}

/* Stars */
/* Common Star Style */
.room-background.night_city .star-blink {
    position: absolute;
    background: white;
    border-radius: 50%;
    box-shadow: 0 0 4px #fff;
    animation: twinkle 3s infinite ease-in-out;
}

/* Night City Stars - Positioned High in Sky (Top 0-15%) */
.room-background.night_city .s1 {
    top: 5%;
    left: 15%;
    width: 2px;
    height: 2px;
    animation-delay: 0s;
}

.room-background.night_city .s2 {
    top: 8%;
    left: 70%;
    width: 3px;
    height: 3px;
    animation-delay: 1.5s;
}

.room-background.night_city .s3 {
    top: 3%;
    left: 40%;
    width: 2px;
    height: 2px;
    animation-delay: 0.8s;
    transform: scale(0.8);
}

.room-background.night_city .s4 {
    top: 12%;
    left: 25%;
    width: 2px;
    height: 2px;
    animation-delay: 2.5s;
}

.room-background.night_city .s5 {
    top: 6%;
    left: 85%;
    width: 2px;
    height: 2px;
    animation-delay: 0.5s;
    transform: scale(0.9);
}

.room-background.night_city .s6 {
    top: 10%;
    left: 55%;
    width: 2px;
    height: 2px;
    animation-delay: 1.8s;
    transform: scale(1.1);
}

.room-background.night_city .s7 {
    top: 2%;
    left: 90%;
    width: 2px;
    height: 2px;
    animation-delay: 3.2s;
    transform: scale(0.7);
}

.room-background.night_city .s8 {
    top: 14%;
    left: 65%;
    width: 2px;
    height: 2px;
    animation-delay: 0.9s;
}

.room-background.night_city .s9 {
    top: 4%;
    left: 10%;
    width: 2px;
    height: 2px;
    animation-delay: 2.1s;
    transform: scale(1.2);
}

.room-background.night_city .s10 {
    top: 9%;
    left: 35%;
    width: 2px;
    height: 2px;
    animation-delay: 1.2s;
}

/* --- Night City Layers --- */
.room-background.night_city {
    /* Theme Variables */
    --city-sky: #0a0a12;
    --city-back: #2a2a40;
    --city-mid: #4a5a7a;
    --city-lit: #94afbc;
    --city-shadow: #00223d;
    --win-lit: rgba(255, 253, 208, 0.7);
    --win-dark: rgba(0, 0, 0, 0.4);
    --car-head: rgba(255, 255, 220, 0.9);
    --car-tail: rgba(255, 100, 100, 0.9);
}

/* Common Layer Positioning */
.room-background.night_city .city-layer-back,
.room-background.night_city .city-layer-middle,
.room-background.night_city .city-layer-front {
    position: absolute;
    bottom: 67%;
    /* Sit on Horizon */
    left: 0;
    width: 100%;
}

/* Layer 3: Back (Furthest - Dark Silhouette) */
.room-background.night_city .city-layer-back {
    height: 30%;
    /* Tallest/Furthest */
    z-index: 10;
    /* High Z-index to sit above reflection */
    background-color: var(--city-back);
    opacity: 0.9;
    /* Dense Background Skyline */
    clip-path: polygon(0% 100%, 0% 40%, 10% 40%, 10% 20%, 20% 20%, 20% 50%,
            30% 50%, 30% 30%, 40% 30%, 40% 60%, 50% 60%, 50% 25%,
            60% 25%, 60% 55%, 70% 55%, 70% 35%, 80% 35%, 80% 65%,
            90% 65%, 90% 40%, 100% 40%, 100% 100%);
}

/* Layer 2: Middle (Mid-distance - Muted Blue-Grey) */
.room-background.night_city .city-layer-middle {
    height: 22%;
    z-index: 11;
    background-color: var(--city-mid);
    /* Mid-density Blocky Skyline */
    clip-path: polygon(0% 100%, 5% 100%, 5% 50%, 15% 50%, 15% 30%, 25% 30%, 25% 60%,
            35% 60%, 35% 40%, 45% 40%, 45% 70%, 55% 70%, 55% 35%, 65% 35%,
            65% 65%, 75% 65%, 75% 45%, 85% 45%, 85% 75%, 95% 75%, 95% 50%,
            100% 50%, 100% 100%);
}

/* Layer 1: Front (Closest - Detailed & Two-Tone 3D) */
.room-background.night_city .city-layer-front {
    height: 18%;
    /* Lowest but most detailed */
    z-index: 12;
    /* Container has no background, children do */
}

/* Individual Buildings */
.room-background.night_city .building {
    position: absolute;
    bottom: 0;

    /* --split defines the 3D corner edge position (default 50%) */
    --split: 50%;
    /* 
     Layered Backgrounds: Mix of Lit and Dark Windows
     5 Lit Columns + 4 Dark Columns
  */
    background-image:
        /* Lit Col 1: 15% */
        linear-gradient(to bottom, var(--win-lit) 3px, transparent 3px),
        /* Dark Col 1: 22% */
        linear-gradient(to bottom, transparent 2px, var(--win-dark) 5px, transparent 5px),
        /* Lit Col 2: 30% */
        linear-gradient(to bottom, transparent 5px, var(--win-lit) 8px, transparent 8px),
        /* Dark Col 2: 40% */
        linear-gradient(to bottom, var(--win-dark) 4px, transparent 4px),
        /* Lit Col 3: 50% */
        linear-gradient(to bottom, transparent 15px, var(--win-lit) 19px, transparent 19px),
        /* Dark Col 3: 60% */
        linear-gradient(to bottom, transparent 8px, var(--win-dark) 12px, transparent 12px),
        /* Lit Col 4: 70% */
        linear-gradient(to bottom, var(--win-lit) 3px, transparent 3px),
        /* Dark Col 4: 78% */
        linear-gradient(to bottom, var(--win-dark) 3px, transparent 3px),
        /* Lit Col 5: 85% */
        linear-gradient(to bottom, transparent 8px, var(--win-lit) 11px, transparent 11px),
        /* Base 3D Shading */
        linear-gradient(90deg, var(--city-lit) var(--split), var(--city-shadow) var(--split));

    /* Size & Repeat */
    background-size:
        2px 20px,
        /* Lit 1 */
        2px 15px,
        /* Dark 1 */
        2px 25px,
        /* Lit 2 */
        2px 18px,
        /* Dark 2 */
        2px 30px,
        /* Lit 3 */
        2px 22px,
        /* Dark 3 */
        2px 18px,
        /* Lit 4 */
        2px 14px,
        /* Dark 4 */
        2px 22px,
        /* Lit 5 */
        100% 100%;
    /* Base */

    background-position:
        15% 0,
        /* Lit 1 */
        22% 5px,
        /* Dark 1 */
        30% 10px,
        /* Lit 2 */
        40% 2px,
        /* Dark 2 */
        50% 5px,
        /* Lit 3 */
        60% 8px,
        /* Dark 3 */
        70% 15px,
        /* Lit 4 */
        78% 0px,
        /* Dark 4 */
        85% 7px,
        /* Lit 5 */
        0 0;

    background-repeat: repeat-y, repeat-y, repeat-y, repeat-y, repeat-y, repeat-y, repeat-y, repeat-y, repeat-y, no-repeat;

    filter: drop-shadow(4px 0 0 rgba(0, 0, 0, 0.3));
}

/* Front Building Shapes - Varied & Architectural */

/* B1: Wide Base Left */
.room-background.night_city .f1 {
    left: -2%;
    width: 12%;
    height: 60%;
    --split: 60%;
    clip-path: polygon(0% 100%, 0% 20%, 60% 20%, 60% 10%, 100% 10%, 100% 100%);
}

/* B2: Narrow Needle/Spire (Ma-cheon-ru) */
.room-background.night_city .f2 {
    left: 8%;
    width: 6%;
    height: 95%;
    /* Very Tall */
    z-index: 4;
    /* Pop out */
    --split: 50%;
    clip-path: polygon(0% 100%, 10% 100%, 10% 10%, 45% 10%, 50% 0%, 55% 10%, 90% 10%, 90% 100%, 100% 100%);
}

/* B3: Stepped Mid-Rise */
.room-background.night_city .f3 {
    left: 12%;
    width: 14%;
    height: 50%;
    z-index: 2;
    /* Behind needle */
    --split: 40%;
    clip-path: polygon(0% 100%, 0% 30%, 30% 30%, 30% 15%, 70% 15%, 70% 40%, 100% 40%, 100% 100%);
}

/* B4: Modern Slant Tower */
.room-background.night_city .f4 {
    left: 24%;
    width: 10%;
    height: 85%;
    --split: 50%;
    clip-path: polygon(0% 100%, 0% 15%, 100% 5%, 100% 100%);
}

/* B5: Central Complex (Twin Design) */
.room-background.night_city .f5 {
    left: 32%;
    width: 18%;
    height: 70%;
    z-index: 3;
    --split: 65%;
    /* Custom background for Twin Tower to alignment windows better? 
     Default is fine, adds random texture 
  */
    clip-path: polygon(0% 100%, 0% 40%, 15% 40%, 15% 10%, 35% 10%, 35% 30%,
            /* Tower 1 */
            65% 30%, 65% 10%, 85% 10%, 85% 40%, 100% 40%, 100% 100%
            /* Tower 2 */
        );
}

/* B6: The Tallest Skyscraper */
.room-background.night_city .f6 {
    left: 48%;
    width: 10%;
    /* Narrow */
    height: 110%;
    /* Breaks top slightly */
    z-index: 5;
    --split: 50%;
    clip-path: polygon(0% 100%, 10% 100%, 10% 20%, 30% 20%, 30% 5%, 48% 0%, 52% 0%, 70% 5%, 70% 20%, 90% 20%, 90% 100%, 100% 100%);
}

/* B7: Layered Block */
.room-background.night_city .f7 {
    left: 56%;
    width: 20%;
    height: 55%;
    z-index: 2;
    --split: 30%;
    clip-path: polygon(0% 100%, 0% 30%, 20% 30%, 20% 10%, 50% 10%, 50% 25%, 80% 25%, 80% 50%, 100% 50%, 100% 100%);
}

/* B8: Right Edge Mass */
.room-background.night_city .f8 {
    left: 74%;
    width: 28%;
    /* Very Wide */
    height: 75%;
    --split: 45%;
    clip-path: polygon(0% 100%, 0% 40%, 15% 40%, 15% 15%, 30% 15%, 30% 5%, 45% 0%,
            60% 0%, 60% 20%, 80% 20%, 80% 40%, 100% 40%, 100% 100%);
}

/* Road (Horizon Line) */
.room-background.night_city .city-road {
    position: absolute;
    top: 33%;
    /* Match reflection start / water line */
    left: 0;
    width: 100%;
    height: 1.4%;
    /* Thin strip */
    z-index: 15;
    /* Above reflection & back/middle layers, below front? front is z:12 */
    /* Actually needs to be visible. Elevating Z-index above reflection (1) and middle (11) but below front (12) 
     Wait, Front (12) is bottom:0. 
     Road at top:33% (which is below bottom:0 relative to wall???)
     Wait, container is Wall (20% height).
     If buildings are bottom:0 of Wall.
     Reflection is top: 33% of Wall -> This is physically inside the wall area?
     No, top: 33% of 20vh wall = 6.6vh from top.
     If buildings are bottom:0, they sit at 20vh.
     
     Ah, if reflection top: 33% looks "correct" as water, maybe "Wall" isn't just 20%.
     
     Assuming Visual placement is correct based on previous user feedback.
  */
    background: linear-gradient(90deg, #1a1a2e, #0f0f1a);
    box-shadow: 0 0 4px rgba(0, 0, 0, 0.8);
    opacity: 0.9;
    z-index: 15;
    /* Ensure visibility */
    overflow: hidden;
    /* Contain traffic */
}

.room-background.night_city .traffic-flow {
    position: absolute;
    width: 100%;
    height: 2px;
    background-repeat: repeat-x;
}

/* Lane 1: Left to Right (Headlights - Warm White) - Irregular Spacing */
.room-background.night_city .flow-right {
    top: 20%;
    /* Pattern repeats every 200px with cars at random intervals */
    background-image: linear-gradient(90deg,
            transparent 0px, transparent 10px,
            var(--car-head) 10px, var(--car-head) 14px,
            /* Car 1 */
            transparent 14px, transparent 60px,
            var(--car-head) 60px, var(--car-head) 64px,
            /* Car 2 */
            transparent 64px, transparent 150px,
            var(--car-head) 150px, var(--car-head) 154px,
            /* Car 3 */
            transparent 154px, transparent 180px,
            var(--car-head) 180px, var(--car-head) 184px,
            /* Car 4 */
            transparent 184px, transparent 200px);
    background-size: 200px 100%;
    animation: traffic-move-right 12s linear infinite;
}

/* Lane 2: Right to Left (Taillights - Red) - Irregular Spacing */
.room-background.night_city .flow-left {
    bottom: 20%;
    /* Pattern repeats every 150px */
    background-image: linear-gradient(90deg,
            transparent 0px, transparent 5px,
            var(--car-tail) 5px, var(--car-tail) 9px,
            /* Car 1 */
            transparent 9px, transparent 40px,
            var(--car-tail) 40px, var(--car-tail) 44px,
            /* Car 2 */
            transparent 44px, transparent 120px,
            var(--car-tail) 120px, var(--car-tail) 124px,
            /* Car 3 */
            transparent 124px, transparent 150px);
    background-size: 150px 100%;
    animation: traffic-move-left 9s linear infinite;
}

@keyframes traffic-move-right {
    from {
        background-position-x: 0;
    }

    to {
        background-position-x: 200px;
    }

    /* Match background-size */
}

@keyframes traffic-move-left {
    from {
        background-position-x: 0;
    }

    to {
        background-position-x: -150px;
    }
}